!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RainbowWebsocket=t():e.RainbowWebsocket=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o="~";function s(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function c(e,t,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new i(n,r||e,s),u=o?o+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],c]:e._events[u].push(c):(e._events[u]=c,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(o=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(o?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=o?o+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,i=new Array(s);r<s;r++)i[r]=n[r].fn;return i},a.prototype.listenerCount=function(e){var t=o?o+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,r,s,i){var c=o?o+e:e;if(!this._events[c])return!1;var u,a,f=this._events[c],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,s),!0;case 6:return f.fn.call(f.context,t,n,r,s,i),!0}for(a=1,u=new Array(l-1);a<l;a++)u[a-1]=arguments[a];f.fn.apply(f.context,u)}else{var p,d=f.length;for(a=0;a<d;a++)switch(f[a].once&&this.removeListener(e,f[a].fn,void 0,!0),l){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,t);break;case 3:f[a].fn.call(f[a].context,t,n);break;case 4:f[a].fn.call(f[a].context,t,n,r);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];f[a].fn.apply(f[a].context,u)}}return!0},a.prototype.on=function(e,t,n){return c(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return c(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,n,r){var s=o?o+e:e;if(!this._events[s])return this;if(!t)return u(this,s),this;var i=this._events[s];if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||u(this,s);else{for(var c=0,a=[],f=i.length;c<f;c++)(i[c].fn!==t||r&&!i[c].once||n&&i[c].context!==n)&&a.push(i[c]);a.length?this._events[s]=1===a.length?a[0]:a:u(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&u(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=o,a.EventEmitter=a,e.exports=a},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t,r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")(),s=Object.prototype,i=0,c=s.toString,u=o.Symbol,a=u?u.prototype:void 0,f=a?a.toString:void 0;function l(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==c.call(e)}(e))return f?f.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}e.exports=function(e){var t,n=++i;return(null==(t=e)?"":l(t))+n}}).call(this,n(2))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t.default=r.RainbowWebsocket},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RainbowWebsocket=void 0;var s=n(0),i=n(5),c=n(6),u=n(7),a=n(8),f=n(1),l=function(e){function t(t){var n=e.call(this)||this;return n._serverUrl=t.url,n._ws=new WebSocket(n._serverUrl),n._logger=t.logger||console,n._waitingQueue=[],n._promises=new Map,n.interceptors={request:new u.InterceptorManager,response:new u.InterceptorManager},n._ws.onmessage=function(e){console.log("RainbowWebsocket has received",e.data),e.data&&"string"==typeof e.data&&e.data.includes('"jsonrpc": "2.0"')&&n.response(e.data)},n._ws.onopen=function(e){n._logger.log("RainbowWebsocket connected to "+n._serverUrl+" successfully......"),n._waitingQueue.forEach((function(e){n._ws.send(n._toDataString(e))}))},n._ws.onclose=function(e){n._logger.log("RainbowWebsocket has close ......");for(var t=0,r=n._promises;t<r.length;t++){r[t][1].reject(c.ErrorCode.DISCONNECT)}},n}return o(t,e),t.prototype.request=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(r,o){var s=Object.assign(e,{id:f("rainbow-websocket-"),jsonrpc:"2.0"}),c=n._requestInterceptorExecutor(s);t||n._promises.set(e.id,{resolve:r,reject:o,method:c.method}),n._ws.readyState!==i.WEBSOCKET_STATE.CONNECTING?(n._logger.log("RainbowWebsocket send data",e),n._ws.send(n._toDataString(e))):n._waitingQueue.push(c)}))},t.prototype.response=function(e){try{var t=JSON.parse(e);this._logger.log("response msg:",e);var n=this._promises.get(t.id);this._promises.delete(t.id),this._logger.log("RainbowWebsocket delete the promise, id=",t.id);var r=this._responseInterceptorExecutor(t);this._logger.log("RainbowWebsocket =======",r),a.isNotifyMsg(t)?this.emit("notify:"+t.method,t.data):r.errCode!==c.ErrorCode.SUCCESS?n.reject(r.errCode):n.resolve(r.data)}catch(e){return void this._logger.error("response msg parse fail")}},t.prototype._requestInterceptorExecutor=function(e){var t=e;return this.interceptors.request.forEach((function(e){t=e(t)})),t},t.prototype._responseInterceptorExecutor=function(e){var t=e;return this.interceptors.response.forEach((function(e){t=e(t)})),t},t.prototype._toDataString=function(e){try{return JSON.stringify(e)}catch(e){this._logger.error("RainbowWallet Stringify data error")}},t}(s);t.RainbowWebsocket=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDK_NAME=t.WEBSOCKET_STATE=void 0,function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(t.WEBSOCKET_STATE||(t.WEBSOCKET_STATE={})),t.SDK_NAME="RainbowWebsocket"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,function(e){e[e.SUCCESS=0]="SUCCESS",e[e.DISCONNECT=404]="DISCONNECT"}(t.ErrorCode||(t.ErrorCode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptorManager=void 0;var r=function(){function e(){return this.handlers=[],this}return e.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},e.prototype.forEach=function(e){this.handlers.forEach(e)},e}();t.InterceptorManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNotifyMsg=void 0,t.isNotifyMsg=function(e){return["jsonrpc","id","event"].every((function(t){return e.hasOwnProperty(t)}))}}]).default}));
//# sourceMappingURL=rainbow-websocket.index.21cce.umd.min.js.map